@page "/gallery"
@implements IDisposable

<h2>Component Gallery</h2>

<A2UISurface SurfaceId="gallery" OnAction="HandleAction" />

@if (_error is not null)
{
    <div class="error-message">@_error</div>
}

@code {
    [Inject] private A2UIStreamClient Client { get; set; } = default!;

    private string? _error;

    protected override Task OnInitializedAsync()
    {
        _ = ConnectInBackground();
        return Task.CompletedTask;
    }

    private async Task ConnectInBackground()
    {
        try
        {
            await Client.ConnectAsync("/agents/gallery");
        }
        catch (Exception ex)
        {
            _error = $"Failed to connect: {ex.Message}";
            await InvokeAsync(StateHasChanged);
        }
    }

    private Task HandleAction(A2UIUserAction action) => Task.CompletedTask;

    public void Dispose() => Client?.Dispose();
}
